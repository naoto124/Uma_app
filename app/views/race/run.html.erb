<div><a href="<%=race_result_path(name:@code)%>">レース結果</a></div>
<div class="col-12 col-md-6 col-sm-12 prof"> 
<%=@couse.couse_name%>
  <table class="race_prof table">
    <tbody>
        <tr class="birthday">
          <h2><%=@race_title%></h2>
        </tr>
        <%@race_title_info.each do |r|%>
          <tr class="birthday">
            <td><%=r%></td>
          </tr>
        <%end%>
    </tbody>
  </table>
</div>

<span class="table-responsive-sm md lg main">
  <table class="uma_race_info table" style = "font-size: 14px;">
    <thead>
      <tr class ="col-xs-3 col-ms-3 col-md-4 col-lg-6" style= width:400px; overflow-y:scroll;>
        <th class ="col-xs-1">枠</th>
        <th class ="col-xs-1">馬番</th>
        <th class ="col-xs-1">馬名</th>
        <th class ="col-xs-1">性・歳</th>
        <th class ="col-xs-1">負荷</th>
        <th class ="col-xs-1">騎手</th>
        <th class ="col-xs-1">人気</th>
        <th class ="col-xs-1">馬：<br>スピード</th>
        <th class ="col-xs-1">馬：<br>パワー</th>
        <th class ="col-xs-1">コース：<br>スピード</th>
        <th class ="col-xs-1">コース：<br>パワー</th>
        <th class ="col-xs-1">条件<br>パラメーター</th>
        <th class ="col-xs-1">合計値</th>
      </tr>
    </thead>
    <tbody>
    <%@uma_info.each do |m|%>
      <tr class ="info_wapper col-xs-3 col-ms-3 col-md-4 col-lg-6">
        <td><%= m[:box]%></td>
        <td><%= m[:uma_number]%></td>
        <td>
          <a href="/uma_detail/<%= m[:uma_name]%>" name="<%= m[:uma_name]%>">
            <%= m[:uma_name]%>
          </a>
        </td>
        <td><%= m[:sex_age]%></td>
        <td><%= m[:weight]%></td>
        <td><%= m[:jokey]%></td>
        <td><%= m[:popular]%></td>
          <%# ここから %>
          <%if @favorite.find {|fa| fa.uma_id == m[:uma_id]}%>
          <%@favorite.each do |f|%>
            <span>
              <td class = "u_speed"><%=f.speed%></td>
              <td class = "u_power"><%=f.power%></td>
            </span>
          <%break%>
          <%end%>
          <%else%>
              <span>
                <td class = "u_speed">1</td>
                <td class = "u_power">1</td>
              </span>
          <%end%>
          <%if @couse_parameter.find {|co| co.couse_id == @couse.couse_id}%>
          <%@couse_parameter.each do |c|%>
            <span>
              <td class = "c_speed"><%=c.speed%></td>
              <td class = "c_power"><%=c.power%></td>
            </span>
          <%break%>
          <%end%>
          <%else%>
            <span>
              <td class = "c_speed">1</td>
              <td class = "c_power">1</td>
            </span>
          <%end%>
          <span>
            <td>
            <label for="speed_select">スピード ×</label>
            <select name=”speed”>
              <option value='1'>1</option>
              <option value='0.5'>0.5</option>
              <option value='0.6'>0.6</option>
              <option value='0.7'>0.7</option>
              <option value='0.8'>0.8</option>
              <option value='0.9'>0.9</option>
              <option value='1.1'>1.1</option>
              <option value='1.2'>1.2</option>
              <option value='1.3'>1.3</option>
              <option value='1.4'>1.4</option>
              <option value='1.5'>1.5</option>
          </select>
          <p class = "t_speed">1</p>
          <br>
          <label for="power_select"> パワー ×</label>
            <select name=”power”>
              <option value='1'>1</option>
              <option value='0.5'>0.5</option>
              <option value='0.6'>0.6</option>
              <option value='0.7'>0.7</option>
              <option value='0.8'>0.8</option>
              <option value='0.9'>0.9</option>
              <option value='1.1'>1.1</option>
              <option value='1.2'>1.2</option>
              <option value='1.3'>1.3</option>
              <option value='1.4'>1.4</option>
              <option value='1.5'>1.5</option>
          </select>
          <p class = "t_power">1</p>
          </td>
          </span>
          <span>
            <td class = "result">a</td>
          </span>
      </tr>
     <%end%>
    </tbody>
  </table>
</span>
<p class="aa">jQuery稼働テスト</p>
<script type="text/javascript">
  $(function() {

    $('.info_wapper').each(function(){
      
    var u_speed = $(this).find('.u_speed').text();
    var u_power = $(this).find('.u_power').text();
    var c_speed = $(this).find('.c_speed').text();
    var c_power = $(this).find('.c_power').text();
    var t_speed = $(this).find('.t_speed').text();
    var t_power = $(this).find('.t_power').text();
    var speed = u_speed * c_speed * t_speed;
    speed = speed.toFixed(1);
    speed = parseFloat(speed);
    var power = u_power * c_power * t_power;
    power = power.toFixed(1);
    power = parseFloat(power);
  

     var select_s= $(this).find('select')[0];
     var select_p= $(this).find('select')[1];
     var s_s = $(this).find('.t_speed');
     var s_p = $(this).find('.t_power');
    //  console.log(select_s);
    //  console.log(val_p);

  result = speed + power
  var result_tb = $(this).find('.result');
  result_tb.text(result);
  // console.log(result);
  // console.log(power);


    function changes(cha,sle,t){
     $(document).on('change',$(cha),function() {
        $(cha).each(function() {
          var val = $(this).val();
          var val = parseFloat(val);
          console.log(val);
          $(sle).text(val);
          t = val;
          speed = speed;
          power = power;
          result = speed + power;
          result_tb.text(result);
        });
      });
    };
    // function changes(cha,sle,t){
    //   $(cha).change(function() {
    //     $(cha).each(function() {
    //       var val = $(this).val();
    //       var val = parseFloat(val);
    //       console.log(val);
    //       $(sle).text(val);
    //       t = val;
    //       speed = speed;
    //       power = power;
    //       result = speed + power;
    //       result_tb.text(result);
    //     });
    //   });
    // };
    changes(select_s,s_s,t_speed);
    changes(select_p,s_p,t_power);


     });
    });
</script>
