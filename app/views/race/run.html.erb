<div><a href="<%=race_result_path(name:@code)%>">レース結果</a></div>
<%= render partial: 'race/race_title', locals:{couse: @couse,race_title: @race_title}, collection:{race_title_info: @race_title_info}%>
<span class="table-responsive-sm md lg main">
  <table class="uma_race_info table" style = "font-size: 14px;">
  <%= render partial: 'race/table_items', collection:{table_items: @table_items}%>
  <tbody>
    <%= render partial: 'race/raceall',locals:{couse: @couse}, collection: @racealls%>
  </tbody>
  </table>
</span>
<script type="text/javascript">

  $(function() {
      $('.info_wapper').each(function(){
      var u_speed = parseFloat($(this).find('.u_speed').text());
      var u_power = parseFloat($(this).find('.u_power').text());
      var c_speed = parseFloat($(this).find('.c_speed').text());
      var c_power = parseFloat($(this).find('.c_power').text());
      var t_speed = $(this).find('.t_speed').text();
      var t_power = $(this).find('.t_power').text();
      var speed = u_speed * c_speed * t_speed;
      speed = speed.toFixed(1);
      speed = parseFloat(speed);
      var power = u_power * c_power * t_power;
      power = power.toFixed(1);
      power = parseFloat(power);
      var result = speed + power;
      var result_tb = $(this).find('.result');
      result_tb.text(result);
        // console.log("tb");
        // console.log(result_tb.text(result));

      var select_s= $(this).find('select')[0];
      var select_p= $(this).find('select')[1];
      var s_s = $(this).find('.t_speed');
      var s_p = $(this).find('.t_power');

      function changes(cha,sle){
        $(cha).change(function() {
          $(cha).each(function() {
            var val = $(this).val();
            var val = parseFloat(val);
          if (cha == select_s){
          t_speed = val
          } else { t_power = val }
          $(sle).text(val);

          $(document).on('change',$(this).find('.t_p'),function(){
            var change_speed = u_speed * c_speed * t_speed;
            change_speed = change_speed.toFixed(1);
            change_speed = parseFloat(change_speed);
            var change_power = u_power * c_power * t_power;
            change_power = change_power.toFixed(1);
            change_power = parseFloat(change_power);
            change_result = change_speed + change_power;
            change_result = change_result.toFixed(1);

            result_tb.text(change_result);
            console.log("aaa");
            console.log(result_tb.text(change_result));
          });

          });
        });
      };
      changes(select_s,s_s);
      changes(select_p,s_p);

    });


    });
</script>
